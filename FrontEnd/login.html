<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <script>
    // Controlla se esiste giÃ  una sessione utente
    function controllaSessione() {
  const utenteSalvato = JSON.parse(localStorage.getItem("utente"));
  if (utenteSalvato && utenteSalvato.privilegio) {
    reindirizza(utenteSalvato.privilegio);
  }
}


function gestisciLogin(user) {

  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  const url = `http://localhost:8080/login/${user}?mail=${username}&password=${password}`;

  fetch(url)
    .then(response => {
      if (!response.ok) {
        throw new Error("Credenziali non valide");
      }
      return response.json();
    })
    .then(data => {
      const privilegio = data.privilegio;
      localStorage.setItem("utente", JSON.stringify(data));
      reindirizza(privilegio);
    })
    .catch(error => {
      document.getElementById("messaggio").textContent = "Login fallito: " + error.message;
    });
}

    function reindirizza(privilegio) {
  if (privilegio === "admin") {
    window.location.href = "admin.html";
  } else if (privilegio === "cliente") {
    window.location.href = "cliente.html";
  } else if (privilegio === "fornitore") {
    window.location.href = "fornitore.html";
  } else {
    document.getElementById("messaggio").textContent = "Privilegio non riconosciuto.";
  }
}

function login() {
    gestisciLogin("cliente");
    gestisciLogin("fornitore");
    gestisciLogin("admin");
}

  </script>
</head>
<body onload="controllaSessione()">
  <h2>Login</h2>

  <form id="loginForm">
    <label for="username">Username:</label><br>
    <input type="text" id="username" name="username"><br><br>

    <label for="password">Password:</label><br>
    <input type="password" id="password" name="password"><br><br>

    <button type="button" onclick="login()">Accedi</button>
  </form>

  <p id="messaggio"></p>

  
</body>
</html>
